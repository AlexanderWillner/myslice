{% extends "layout-unfold1.html" %}

{% block head %}
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}/css/onelab.css"/>
<link rel="stylesheet" type="text/css" href="{{STATIC_URL}}/css/account_view.css" />
<script type="text/javascript" src="{{STATIC_URL}}/js/jquery.validate.js"></script> 
<script type="text/javascript" src="{{STATIC_URL}}/js/my_account.edit_profile.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}/js/my_account.register.js"></script>
{% endblock %}

{% block unfold_main %}

<h2>User Profile <small>User info. in Myslice platform</small></h2>

{% if messages %}
<ul class="messages">
    {% for message in messages %}
    <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
</ul>
{% endif %}


<form id="editForm"  method="POST" action="account_process" enctype="multipart/form-data">
<div id="middle" align="center">
	<div class="well">
	  	{% csrf_token %}
	  		<table class="profile">          
	    		<tr class="odd">
	      			<td colspan="2">
						<div id="info">Platform: Myslice</div>
	      			</td>
	    		</tr>
	    		<tr class="even">
	      			<td class="key">Email</td>
	      			<td class="value">
						<span id="emailval" class="value" >{{ person.email }}</span>
						<img class="img-thumbnail" src="{{STATIC_URL}}/img/ques_icon.png" onclick="emailAlert()"  title="To change your email please contact the administrator" 
							 style="height: 24px;  position: absolute; left: 625px; left: 900px; margin-top: -3px;">
					</td>
	      		</tr>
	      		<tr class="odd">
					<td class="key">Password</td>
					<td class="value"> 
		  				<button class="btn btn-default btn-xs" type="button" title="Password" name="edit_pass" id="edit_pass">Edit</button>
		  				<span id="passval"class="value">******** </span>
		  				<span class="hide_this" id="span_pass">
		    				<button type="button" class="btn btn-default btn-xs" title="Cancel" id="cancel_pass_change"> Cancel </button>
		    				<div style='display:none;' id="pass_form">
		    				<input type='hidden'  value='' /></div>
		    				<table id="edit_password">
		      					<tr>
									<td>Enter password: </td>
									<td class="field"> <input type="password" name="password" id="password" /> </td>
		      						</tr>
		      						<tr>
									<td>Confirm password: </td>
									<td class="field"> 
			  							<input type="password" name="confirmpassword" id="confirmpassword" /> 
			  							<input type="submit" class="btn btn-default btn-xs" name="submit_pass" value="Save"/> 
									</td>
		      					</tr>
		    				</table>
		  				</span>	
					</td>
	      		</tr>
	      		<tr class="even">
					<td class="key">Full Name</td>
					<td class="value">
		  				<span id="nameval" class="value" >{{ fullname }} </span>
		  				<span class="hide_this" id="span_name">
		    				<button type="button" class="btn btn-default btn-xs" title="Cancel" id="cancel_name_change"> Cancel </button> 
		    				<div style='display:none;'><input type='hidden'  name='nameform'  /></div>
		    				<input id="fname" type="text" name="fname" class="required"  maxlength="200" value="{{firstname}}" />
		    				<input id="lname" type="text" name="lname" class="required"  maxlength="200" value="{{lastname}}" />
		    				<input type="submit" class="btn btn-default btn-xs" name="submit_name" value="Save"/>
		  				</span>
		  				<button class="btn btn-default btn-xs" type="button"title="Full Name" id="edit_name">Edit</button>
					</td>
	      		</tr>
	      		<tr class="odd">
					<td class="key">Authority</td>
					<td class="value">
		  				<span id="affval" class="value">{{ authority }}</span>
		  				<img class="img-thumbnail" src="{{STATIC_URL}}/img/ques_icon.png" onclick="affAlert()"  title="To change your affiliation please contact the administrator" 
							 style="height: 24px; position: absolute; left: 625px; left: 900px; margin-top:-3px; ">
		  			</td>
				</tr>
				<tr class="even">
		  			<td class="key">Generate Keys</td>
		  			<td> 
		  				<button id="generate_keypair" class="btn btn-danger btn-xs" name="generate" type="submit" onclick="myFunction()" 
								title="Generate a new key pair. After it is generated, you will need to download your public and private keys again.">Generate a new Key Pair 
						</button>
	      			</td> 
	    		</tr>
	    		<tr class="odd">
	      			<td class="key">Public Key</td>
	      			<td class="value">
						<span id="keyval" class="value">******** </span>
						<span class="hide_this" id="span_upload">
		  					<button type="button" class="btn btn-default btn-xs" title="Cancel" id="cancel_upload"> Cancel </button>
		  					<div style='display:none;'>
		  					<input type='hidden'  name='upload'  /></div>
		  					<input type="file" name="pubkey" class="required" id="pubkey"/>  
		  					<button class="btn btn-default btn-xs" name="upload_key" id="upload_key"  type="submit" title="Delete your private key">Upload </button>
						</span>
						<div style='display:none;'> <input type='hidden'  name='dload'  /> </div> 
						<button type="submit" name="dl_pubkey" class="btn btn-default btn-xs" title="Download your public key" id="dl_file"> Download </button>
						<button class="btn btn-default btn-xs" id="upload_file" type="button" title="Upload a public key"> Upload </button>       
	      			</td>
	    		</tr>
	    		<tr class="even" id="pkey_row">
				 {%if 'N/A' not in user_private_key%}
	      			<td class="key">Private Key </td> <!-- Hide if priv_key doesn't exist in myslice platform   -->
	      			<td class="value">********<a href="#">
	      				<button type="submit" name="dl_pkey" class="btn btn-default btn-xs" title="Download your privaye key" id="dl_pkey"> Download </button>
	      				<button class="btn btn-danger btn-xs" id="delete" name="delete" type="submit" title="Delete your private key">Delete </button>
	    			</td>
				 {%endif%}		
	  			</tr>
	  			<tr class="odd">
	    			<td colspan="2">
	      				<p class="message" id="pkey_del_msg"><b> Tradeoff:</b> Ease-of-use vs Security.<br>
							<b>Ease-of-use:</b> Automatic account delegation. Don't delete private key.<br>
							<b>Security:</b> Manual account delegation. Download & Delete private key.
						</p>
	    			</td>
	  			</tr>
			</table>
	</div>
</div>

<h2>Account Information</h2>
<h3>Principal Account <small>Account used for delegating credentials</small></h3>
<div id="middle" align="center">
	<div class="well">
		<table class="table table-bordered table-hover  mytable"> 
			<tr class="odd"> 
    			<th>Platform</th> 
        		<th>Account Type</th>
				<th>Account Delegation</th>
        		<th>User hrn</th>
        		<!--<th>Pub Key</th> -->
    		</tr>   
			{% for row in principal_acc %}         
   			<tr class="border_bottom">
    			<td class="odd"> {{ row.platform_name }} </td>
        		<td class="odd"> {{ row.account_type }} </td>
				<td class="odd"> {{ row.delegation_type }} </td>
       			<td class="odd"> {{ row.usr_hrn }}  </td>
        	<!--	<td class="even"> {{ row.usr_pubkey }} </td> -->
    		</tr> 
			{%endfor%}               
		</table>
	</div>
</div>


<h3>Credentials</h3>
<div id="middle" align="center">
    <div class="well">
        <table class="mytable table table-bordered table-hover">
			<caption><b>Delegated User Credential</b></caption> 
            <tr class="odd"> 
                <th>Expiration Date</th>
				<th>Download</th>
            </tr>
			{% for row in my_users %}         
			<tr class="border_bottom">
    			<td class="odd"> {{ row.cred_exp }} </td>
				<td class="odd"><button class="btn btn-default btn-xs" name= "dl_user_cred" type="submit" title="Download User Credential">Download</button></td>
			</tr>
			{%endfor%}
		 </table>
		<p></p>
		<table class="mytable table table-bordered table-hover">
			<caption><b>Delegated Slice Credentials</b></caption>  
     		<tr class="odd"> 
				<th>Slice Name</th> 
         		<th>Expiration Date</th>
				<th>Download</th>
     		</tr>
			{% for row in my_slices %}     
     		<tr class="border_bottom">
         		<td class="odd"> {{ row.slice_name }} </td>
				<td class="odd"> {{ row.cred_exp }} </td>
				<td class="odd"> <button class="btn btn-default btn-xs" name= "dl_slice_cred" type="submit" title="Download Slice Credentials">Download</button> </td>
     		</tr>
     		{%endfor%}
  		</table>
		<p></p>
		<table class="mytable table table-bordered table-hover">
   			<caption><b>Delegated Authority Credentials</b></caption>
   			<tr class="odd"> 
       			<th>Authority Name</th> 
       			<th>Expiration Date</th>
				<th>Download</th>
   			</tr>
   			{% for row in my_auths %}
   			<tr class="border_bottom">
       			<td class="odd"> {{ row.auth_name }} </td>
       			<td class="odd"> {{ row.cred_exp }} </td>
				<td class="odd"><button class="btn btn-default btn-xs" name= "dl_auth_cred" type="submit" title="Download Authority Credentials">Download</button></td>
   			</tr>
   			{%endfor%}
		</table>
		<p></p>	
		<p><button class="btn btn-danger btn-lg btn-block"   name= "clear_cred" type="submit" title="Clear All Credentials">Clear Credentials</button></p>
    </div>
</div>




<h3>Testbed Accounts <small>Reference accounts in the following testbeds</small></h3>
<div id="middle" align="center">
    <div class="well">
        <table class="mytable table table-bordered table-hover"> 
            <tr class="odd"> 
                <th>Platform</th> 
                <th>Account Type</th>
				<th>Reference to</th>
				<th>Remove Account</th>
            </tr>   
            {% for row in ref_acc %}         
            <tr class="border_bottom">
                <td class="odd"> {{ row.platform_name }} </td>
                <td class="odd"> {{ row.account_type }} </td>
				<td class="odd"> {{ row.account_reference }} </td>
				<td class="odd">
    				<button class="btn btn-danger btn-xs" name="delete_{{row.platform_name}}" type="submit" title="Delete account from this platform">Delete</button>
				</td>
            </tr> 
            {%endfor%}               
        </table>
    </div>
</div>

<h3>Add Accounts <small>Add ref. account to the following testbeds</small></h3>
<div id="middle" align="center">
    <div class="well">
        <table class="mytable table table-bordered table-hover"> 
            <tr class="odd"> 
                <th>Platforms</th> 
                <th>Add Account</th>
            </tr>   
            {% for platform in platform_list %}         
            <tr class="border_bottom">
                <td class="odd"> {{ platform.platform_no_access }} </td>
                <td class="odd">
					<button class="btn btn-success btn-xs" name= "add_{{platform.platform_no_access}}" type="submit" title="Add account to this platform">Add</button>
				</td>
            </tr> 
            {%endfor%}               
        </table>
    </div>
</div>

</form>

{% endblock %}
