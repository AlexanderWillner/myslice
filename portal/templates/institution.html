{% extends "layout-unfold1.html" %}

{% block unfold_main %}
<div class="wrapper" id="institution">
    <ul class="nav nav-tabs">
      <li class="active"><a class="home-tab" data-panel="institution" href="#">INSTITUTION</a></li>
      <li><a class="home-tab" data-panel="users" href="#">USERS</a></li>
      <li><a class="home-tab" data-panel="slices" href="#">SLICES</a></li>
    </ul>
    <div class="home-panel" id="institution">
        <h1><img src="{{ STATIC_URL }}img/icon_authority_color_small.png" alt="" /> Affiliation to an Institution</h1>
        <br>
        <div style="float:left; width:30%;">
            
            <img src="{{ STATIC_URL }}img/onelab-logo.png" alt="" /><br>
            <b>Membership:</b> Governor
        </div>
        <div style="float:right; width:70%;">
            <img src="http://www.upmc.fr/skins/UPMC/templates/index/resources/img/upmc-logotype.gif" alt="" /><br>
            <br>
            <b>authority:</b> onelab.upmc<br>
            <br>
            <b>Université Pierre et Marie Curie</b><br>
            <br>
            <b>Address:</b> 4 Place Jussieu, 75005 Paris<br>
            <br>
            <b>Country:</b> France<br>
            <br>
            <br>
            <h2>Contacts</h2>
            <b>Legal:</b> Président Jean Chambaz<br>
            <br>
            <b>Scientific:</b> Dr Timur Friedman, Prof Serge Fdida
        </div>
    </div>
    <div class="home-panel" id="users" style="display:none;">
		<br>
        <h1>Users: onelab.upmc</button></h1>
        <div id="user-tab-loading"><img src="{{ STATIC_URL }}img/loading.gif" alt="Loading Slices" /></div>
        <div id="user-tab-loaded" style="display:none;">
            <table id="user-tab">
                <tr>
                    <th>+/-</th>
                    <th>Email</th>
                    <th>user_hrn</th>
                    <th>First name</th>
                    <th>Last name</th>
                    <th>Enabled</th>
                </tr>
            </table>
        </div>
        <div>
            <button id="deleteusers" type="button" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Delete Users</button>
        </div>
  	</div>
    <div class="home-panel" id="slices" style="display:none;">
        <br>
        <h1>Slices: onelab.upmc <button id="createslice" type="button" class="btn btn-default"><span class="glyphicon glyphicon-plus"></span> Create a Slice</button></h1>
        <div id="slice-tab-loading"><img src="{{ STATIC_URL }}img/loading.gif" alt="Loading Slices" /></div>
        <div id="slice-tab-loaded" style="display:none;">
            <table id="slice-tab">
                <tr>
                    <th>+/-</th>
                    <th>slice_hrn</th>
                    <th>users</th>
                    <th>url</th>
                    <th>nodes</th>
                    <th>expiration</th>
                </tr>
            </table>
            <div>
                <button id="renewslices" type="button" class="btn btn-default"><span class="glyphicon glyphicon-refresh"></span> Renew Slices</button>
                <button id="deleteslices" type="button" class="btn btn-default"><span class="glyphicon glyphicon-remove"></span> Delete Slices</button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $('a.home-tab').click(function() {
            $('ul.nav-tabs li').removeClass('active');
            $(this).parent().addClass('active');
            $('div.home-panel').hide();
            $('div#'+$(this).data('panel')).show();
        });
        $('button#createslice').click(function() {
            window.location="/portal/slice_request/";
        })
        ;$('button#slicerequestbtn').click(function() {
            /*
            window.location="/portal/slice_request/";
            */
        });
        {% if person %}
        $.getJSON("/rest/slice/", function( data ) {
            var list_slices = [];
            var table_slices = [];
            /* "slice_hrn", "slice_description", "slice_type", "parent_authority", "created", "nodes", "slice_url", "slice_last_updated", "user", "slice_urn", "slice_expires" */
            $.each( data, function( key, val ) {
                list_slices.push( "<li><a href=\"portal/slice/"+val.slice_hrn+"\">" + val.slice_hrn + "</a></li>" );
                if(val.nodes=="undefined" || val.nodes==null){
                    nodes_length=0;
                }else{
                    nodes_length=val.nodes.length;
                }

                if(val.user=="undefined" || val.user==null){
                    user_length=0;
                }else{
                    user_length=val.user.length;
                }

                if(val.slice_url=="undefined" || val.slice_url==null){
                    slice_url="";
                }else{
                    slice_url="<a href='"+val.slice_url+"' target='_blank'>"+val.slice_url+"</a>";
                }
                
                slice_row = "<tr>";
                slice_row += "<td><input type='checkbox'></td>";
                slice_row += "<td><a href=\"/portal/slice/"+val.slice_hrn+"\">" + val.slice_hrn + "</a></td>";
                slice_row += "<td>"+user_length+"</td>";
                slice_row += "<td>"+slice_url+"</td>";
                slice_row += "<td>"+nodes_length+"</td>";
                slice_row += "<td>"+val.slice_expires+"</td>";
                table_slices.push(slice_row);
                
            });
           
            /* $("div#slice-list").html($( "<ul/>", { html: list_slices.join( "" ) })); */
            $("table#slice-tab tr:last").after(table_slices.join( "" ));
            $("div#slice-tab-loaded").css("display","block");
            $("div#slice-tab-loading").css("display","none");
         });
         {% endif %}
		{% if person %}
        $.getJSON("/rest/user/", function( data ) {
            var list_users = [];
            var table_users = [];
			/*
			"enabled", "keys", "parent_authority", "user_first_name", "user_last_name", "user_phone", "user_hrn", "slice", "user_email"
			*/
            $.each( data, function( key, val ) {
                list_users.push( "<li><a href=\"portal/user/"+val.user_email+"\">" + val.user_email + "</a></li>" );
                /*if(val.nodes=="undefined" || val.nodes==null){
                    nodes_length=0;
                }else{
                    nodes_length=val.nodes.length;
                }

                if(val.user=="undefined" || val.user==null){
                    user_length=0;
                }else{
                    user_length=val.user.length;
                }

                if(val.slice_url=="undefined" || val.slice_url==null){
                    slice_url="";
                }else{
                    slice_url="<a href='"+val.slice_url+"' target='_blank'>"+val.slice_url+"</a>";
                }*/
                
                user_row = "<tr>";
                user_row += "<td><input type='checkbox'></td>";
                user_row += "<td>"+val.user_email+"</td>";
                user_row += "<td>"+val.user_hrn+"</td>";
                user_row += "<td>"+val.user_first_name+"</td>";
                user_row += "<td>"+val.user_last_name+"</td>";
				user_row += "<td>"+val.enabled+"</td>";
                table_users.push(user_row);
                
            });
           
            /* $("div#slice-list").html($( "<ul/>", { html: list_slices.join( "" ) })); */
            $("table#user-tab tr:last").after(table_users.join( "" ));
            $("div#user-tab-loaded").css("display","block");
            $("div#user-tab-loading").css("display","none");
         });
         {% endif %}
    });
</script>
{% endblock unfold_main %}
