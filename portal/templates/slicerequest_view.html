{% extends "layout.html" %}
{% load i18n %}

{% block content %}
	<div class="row">
		<div class="col-md-12">
		<h1><img src="{{ STATIC_URL }}icons/slices-xs.png" alt="Request a Slice" /> Request a new Slice</h1>
		</div>
	</div>

	{% if errors %}
	<ul>
	  {% for error in errors %}
	  <li>{{ error }}</li>
	  {% endfor %}
	</ul>
	{% endif %}
	<div class="row">
		<div class="col-md-12">&nbsp;</div>
	</div>
	<div class="row">
		<div class="col-md-2"></div>
		<div class="col-md-8">
			<form role="form" method="post">
			{% csrf_token %}
			  <div class="form-group">
			    <label for="email">Experimenter</label>
			    <input type="email" class="form-control" id="email" value="{{ email }}" readonly="readonly">
			  </div>
			  <div class="form-group">
			    <label for="slice_name">Slice Name</label>
			    <input type="text" class="form-control" name="slice_name" id="slice_name" placeholder="Slice Name" required="required">
			  	<p class="help-block"></p>
			  </div>
			  <div class="form-group">
			    <label for="authority">Authority</label>
			    <input type="text" class="form-control" id="authority_hrn" name="authority_hrn" placeholder="Authority" required="required" readonly="readonly">
			  	<p class="help-block">An authority responsible for vetting your slice</p>
			  </div>
			  <div class="form-group">
			    <label for="number_of_nodes">Number of Nodes</label>
			    <input type="text" class="form-control" name="number_of_nodes" id="number_of_nodes" placeholder="Number of Nodes">
			  	<p class="help-block">Number of nodes you expect to request (informative)</p>
			  </div>
			  <div class="form-group">
			    <label for="purpose">Experiment Purpose</label>
			  	<textarea id="purpose" name="purpose" class="form-control" rows="6" placeholder="Experiment Purpose" required="required">{{ purpose }}</textarea>
			    <p class="help-block">Purpose of your experiment (informative)</p>
			  </div>
			  <button type="submit" class="btn btn-default">Request Slice</button>
			</form>
	
		</div>
	</div>
		
<script>
jQuery(document).ready(function(){
	
	$("#authority_hrn").load("/rest/user/", {"fields" : ["parent_authority"], "filters": {"user_hrn": "{{ user_hrn }}"}}, function(data) {
		var jsonData = JSON.parse(data)
        $(this).attr("value", jsonData[0]['parent_authority']);
    });
    var availableTags = [
     {% if authorities %}
         {% for authority in authorities %}
             {% if authority.name %}
                 {value:"{{ authority.authority_hrn }}",label:"{{authority.name}}"},
             {% else %}
                 {value:"{{ authority.authority_hrn }}",label:"{{authority.authority_hrn}}"},
             {% endif %}
         {% endfor %}    
     {% else %}
         {value:"",label:"No authority found !!!"}
     {% endif %}
    ];
    $( "#authority_hrn" ).autocomplete({
      source: availableTags,
      minLength: 0,
      select: function( event, ui ) {console.log(jQuery(this))}
    });
});
</script>
{% endblock %}

