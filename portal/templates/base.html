{% load portal_filters %}
{# This is required by insert_above #}{% insert_handler %}<!DOCTYPE html>
<html lang="en"><head>
<title>{{theme}} portal - {{ section }}</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="shortcut icon" href="/static/img/favicon_fed4fire.ico">
{# This is where insert_str will end up #}{% media_container prelude %}
{% include 'messages-transient-header.html' %}
<script type="text/javascript"> {# raw js code - use {% insert prelude_js %} ... {% endinsert %} #} {% container prelude_js %}</script>
<script src="{{ STATIC_URL }}js/jquery.dataTables.min.js"></script>
<script src="{{ STATIC_URL }}js/bootstrap.datatables.js"></script>
<!-- <script src="{{ STATIC_URL }}js/stash.min.js"></script> -->
<script src="{{ STATIC_URL }}js/myslice.js"></script>
<script src="{{ STATIC_URL }}js/myslice-ui.js"></script>
<style type="text/css">{# In case we need to add raw css code #}{% container prelude_css %}</style>
{{ header_prelude }}
{% block head %} {% endblock head %}
{# let's add these ones no matter what #}
{% insert_str prelude "js/jquery.min.js" %}
{% insert_str prelude "js/jquery.html5storage.min.js" %}
{% insert_str prelude "js/messages-runtime.js" %}
{% insert_str prelude "js/class.js" %}
{% insert_str prelude "js/plugin-helper.js" %}
{% insert_str prelude "js/mustache.js" %}
{% insert_str prelude "js/plugin.js" %}
{% insert_str prelude "js/manifold.js" %}
{% insert_str prelude "css/manifold.css" %}
{% insert_str prelude "css/plugin.css" %}
{% insert_str prelude "js/bootstrap.js" %}
{% insert_str prelude "css/bootstrap.css" %}
{% insert_str prelude "css/topmenu.css" %}
{% insert_str prelude "js/logout.js" %}
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}css/{{ theme }}.css">

<script type="text/javascript">
/*
XXX TODO: session
This list of slices should go into SESSION !
*/
$(document).ready(function() {
    {% if username %}
    myslice.login();

    user = myslice.user();
    
    var slices = [];
    if($.isEmptyObject(user)){
        $.post("/rest/user/",{'filters':{'user_hrn':'$user_hrn'}}, function( data ) {
            if(data.length > 0){
                drawSlices(data[0].slices);  
            }else{
            	$("div#home-slice-list").html("<div>no slice</div>");
        		$("ul#dropdown-slice-list").append("<li>no slice</li>");
                slices.push("no slice");
            }
    	});
    }else{
        slices = user.slices;
        drawSlices(slices);
    }
    function drawSlices(slices){
        var items = [];
        $.each( slices, function(i, val) {
            items.push( "<li><a href=\"/slice/"+val+"\">" + val + "</a></li>" );
        });
        $("div#home-slice-list").html($( "<ul/>", { html: items.join( "" ) }));
        $("ul#dropdown-slice-list").append(items.join( "" ));
    }
    {% endif %}
});
</script>
</head>
<body>
{% block container %}
  	{% block topmenu %}
  	{% widget "_widget-topmenu.html" %}
  	{% endblock topmenu %}
	{% include 'messages-transient.html' %}
	{% block base_content %}
	{% endblock %}
{% endblock container %}
</body>
</html>
